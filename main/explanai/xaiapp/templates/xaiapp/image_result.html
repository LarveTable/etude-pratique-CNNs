{% extends "xaiapp/base.html"%} {%block title %} Results {% endblock %}
{%block content %}

<div class="container">
<!-- <a class="btn btn-primary m-2" href="/result/{{experiment_id}}/">Back to experiment</a> -->

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/result/{{experiment_id}}/">Experiment</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{in_image.image}}</li>
  </ol>
</nav>

  <div class="p-2 container border rounded m-2">
    <h4>{{in_image.image}} </h4>
        <img src="{{in_image.image.url}}" class="" style="width: 100%; height:100%;"
        alt="{{in_image.image.url}}"
        title="{{in_image.image.url}}">
  </div>
</div>
<!-- Use a for each methods instead-->
<div class="container">
  <div class="p-2 container border rounded m-2">
    <h4>Integrated Gradient</h4>
        <img src="{{in_image.image.url}}" class="" style="width: 100%; height:100%;"
        alt="{{in_image.image.url}}"
        title="{{in_image.image.url}}">
  </div>
</div>

<div class="container">
  <div class="p-2 container border rounded m-2">
    <h4>LIME</h4>
        <img src="{{in_image.image.url}}" class="" style="width: 100%; height:100%;"
        alt="{{in_image.image.url}}"
        title="{{in_image.image.url}}">
  </div>
</div>
 
<!-- disabled script for now-->
<script type="plain/text">
  // SSE
    const eventSource = new EventSource("/experiment_update/" + "{{experiment_id}}/");

    console.log("ready for updates on Expe:" + "{{experiment_id}}" + "{{experiment_status}}");
    // When a message is received 
    eventSource.onmessage = function(e){
      const data = JSON.parse(e.data);
      console.log(data);

      // Update UI status for every cards 
      // each img status :
      // find by Id 
      // Change border according to status
      const imagesStatus = data.status;
      imagesStatus.forEach(imgS => {
        console.log(imgS);
        const imgCard = document.getElementById(imgS.imgName)
        const imgStatus = imgS.status; 
        console.log(imgStatus);
        switch(imgStatus){
          case "finished":
           updateClass(imgS.imgName,"border-warning", "border-success");
           break;
        }
      });
      // If the experiment is done : close the updates
      if("{{experiment_status}}" == "finished"){
        eventSource.close();
      }
    };


    eventSource.onerror = function(e){
      console.error('EventSource failed:', e);
    };

    function updateClass(id, oldClass, newClass){
      const e = document.getElementById(id);
    
      e.classList.remove(oldClass);
      e.classList.add(newClass);
    }

</script>


{% endblock %}